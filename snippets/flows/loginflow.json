{
  "LoginFlow":{
    "prefix": "ktfl",
    "body": [
      "intents:",
      "\treenter:",
      "\t\ttype: command",
      "\t\tcondition: content == \"reenter\"",
      "\tintent_hit_api:",
      "\t\ttype: command",
      "\t\tcondition: \"content == 'hit_api'\"", 
      "\tintent_login:",
      "\t\tinitial: true",
      "\t\ttype: text",
      "\t\tclassifier:",
      "\t\t\tnlu: auth",
      "\t\t\tmatch: login",  
      "\tintent_text:",
      "\t\ttype: text",  
      "states:",
      "\tstate_initial:",
      "\t\tinitial: true",
      "\t\ttransitions:",
      "\t\t\tstate_already_login:",
      "\t\t\t\tcondition: \"intent == 'intent_login' && data.token\"",
      "\t\t\tstate_ask_username:",
      "\t\t\t\tcondition: \"intent == 'intent_login' && data.token == '' || intent == 'intent_login' && !data.token\"",
      "\tstate_already_login:",
      "\t\tend: true",
      "\t\taction:",
      "\t\t\t- name: \"act_already_login\"",    
      "\tstate_ask_username:",
      "\t\taction:",
      "\t\t\t- name: \"act_ask_username\"",
      "\t\ttransitions:",
      "\t\t\tstate_ask_password:",
      "\t\t\t\tcondition: \"intent == 'intent_text'\"",
      "\t\t\t\tmapping:",
      "\t\t\t\t\tcontext.username: content",
      "\t\t\tstate_ask_username:",
      "\t\t\t\tfallback: true",
      "\tstate_ask_password:",
      "\t\taction:",
      "\t\t\t- name: \"act_ask_password\"",
      "\t\ttransitions:",
      "\t\t\tstate_hit_api_login:",
      "\t\t\t\tcondition: \"intent == 'intent_text'\"",
      "\t\t\t\tmapping:",
      "\t\t\t\t\tcontext.password: content",
      "\t\t\tstate_ask_password:",
      "\t\t\t\tfallback: true",
      "\tstate_hit_api_login:",
      "\t\taction:",
      "\t\t\t- name: act_hit_api_login",
      "\t\t\t- name: command",
      "\t\t\t\toptions:",
      "\t\t\t\t\tcommand: hit_api",
      "\t\t\t\t\tpayload:",
      "\t\t\t\t\t\tresult: $(result)",
      "\t\ttransitions:",
      "\t\t\tstate_success:",
      "\t\t\t\tcondition: payload.result.message",
      "\t\t\t\tmapping:",
      "\t\t\t\t\tdata.token: payload.result.message.token",
      "\t\t\tstate_failed:",
      "\t\t\t\tcondition: payload.result.error",
      "\t\t\tstate_error:",
      "\t\t\t\tfallback: true",
      "\tstate_success:",
      "\t\tend: true",
      "\t\taction:",
      "\t\t\t- name: \"act_succes_login\"",
      "\tstate_failed:",
      "\t\tend: true",
      "\t\taction:",
      "\t\t\t- name: \"act_failed_login\"",
      "\tstate_error:",
      "\t\tend: true",
      "\t\taction:",
      "\t\t\t- name:\"act_error_login\"",
    "actions:",
    "\tact_hit_api_login:",
    "\t\ttype: api",
    "\t\toptions:",
    "\t\t\tmethod: POST",
    "\t\t\tbody:",
    "\t\t\t\tusername: $(context.username)", 
    "\t\t\t\tpassword: $(context.password)", 
    "\t\t\turi: \"$(config.urlAPI)/login\"",
    "\tact_ask_username:",
    "\t\ttype: \"text\"",
    "\t\toptions:",
    "\t\t\ttext:",
    "\t\t\t\t- \"Please input username\"",
    "\tact_ask_password:",
    "\t\ttype: \"text\"",
    "\t\toptions:",
    "\t\t\ttext:",
    "\t\t\t\t- \"Please input password\"",
    "\tact_succes_login:",
    "\t\ttype: \"text\"",
    "\t\toptions:",
    "\t\t\ttext:",
    "\t\t\t\t- \"Login succes..\"",
    "\tact_failed_login:",
    "\t\ttype: \"text\"",
    "\t\toptions:",
    "\t\t\ttext:",
    "\t\t\t\t- \"$(payload.result.error)\"",
    "\tact_error_login:",
    "\t\ttype: \"text\"",
    "\t\toptions:",
    "\t\t\ttext:",
    "\t\t\t\t- \"Error. Try again..\"",
    "\tact_already_login:",
    "\t\ttype: \"text\"",
    "\t\toptions:",
    "\t\t\ttext:",
    "\t\t\t\t- \"You are currently logged in\""
    ],
    "description": "Login Example"
  }
}